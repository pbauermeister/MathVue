<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="bootstrap4-dialog.css">
    
    <!-- Font Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>

    <link rel="stylesheet" href="style.css">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  </head>
  
  <body class="p-md-3 p-1 mr-3 mr-md-0">

    <!-- Github -->
    <a href="https://github.com/pbauermeister/MathVue" target="_blank">
      <img style="position: absolute; top: 0; right: 0; border: 0;"
	   src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
	   alt="Fork me on GitHub">
    </a>

    
    <h1>MathVue</h1>

    <!-- Our Vue template -->
    <div id="app">
      <div v-cloak>

        {{ message }}

        <!-- Formula -->
        <div class="row">
          <div class="col-md-6 pt-3">
            <h2>Formula</h2>
            <textarea v-model="formula"
                      class="formula-textarea"
                      v-on:input="onInput()"
                      ></textarea>
            <button class="btn btn-sm btn-primary" v-on:click="run">Run</button>
            <button class="btn btn-sm btn-primary" v-on:click="pause" v-show="started && running">Pause</button>
            <button class="btn btn-sm btn-primary" v-on:click="resume" v-show="started && !running">Resume</button>
          </div>
          
          <!-- Canvas -->
          <div class="col-md-6 pt-3">
            <h2>Canvas</h2>
            <div style="display: inline-block">
              <canvas id="mathvisionCanvas" width="300" height="300"
                      style="border: 1px solid lightgrey; max-width:100%">
              </canvas>

              <!-- buttons -->
              <br/>
              <div class="float-left">
                <a style="cursor:pointer" title="Play"
                   v-bind:class="{ 'text-muted': running }"
                   v-bind:disabled="running"
                   v-on:click="resume"><i class="fa fa-play" aria-hidden="true"></i></a>

                <a style="cursor:pointer" title="Pause"
                   v-bind:class="{ 'text-muted': !running }"
                   v-bind:disabled="!running"
                   v-on:click="pause"><i class="fa fa-pause" aria-hidden="true"></i></a>
              </div>
              <div class="float-right">
                <a id="fullScreenButton"
                   style="cursor:pointer" title="Full screen"
                   v-on:click="fullScreen"><i class="fa fa-expand" aria-hidden="true"></i></a>
              </div>
            </div>
          </div>
        </div>

        <!-- Help Panel -->
        <br/>

        <div class="wrap-collabsible">
          <input id="collapsible" class="toggle" type="checkbox">
          <label for="collapsible" class="lbl-toggle">Formula syntax</label>
          <div class="collapsible-content">
            <div class="content-inner">

              <div class="card">
                <div>
                  For language syntax, see
                  <a href="http://processingjs.org/learning/">http://processingjs.org/learning/</a>.
                  For a list of math functions see
                  <a href="http://processingjs.org/reference/">http://processingjs.org/reference/</a>. <br/>&nbsp;
                </div>
                <div class="row">
                  <div class="col">
                    <pre>
The following parameters may be redefined:
- int WIDTH, HEIGHT ..... Define the range of the canvas space
- float RATIO ........... If HEIGHT is left 0, is used to compute HEIGHT; if
                            RATIO set to AUTO, calculated after X/Y spans
- int X_MIN, X_MAX ...... These two parameters define the range of the
- int Y_MIN, Y_MAX          parametric space
- float TIME_INCREMENT .. Time increment for animation
- bool CLICK_PAUSE ...... If true, clicking canvas toggles animation on/off
- bool OUT_PAUSE ........ If true, mouse outside canvas stops animation
- bool MOUSE_MOVE ....... If true and no animation, redraw frame on mouse
                            moves
- int FRAMES ............ In animation mode, defines the number of wanted
                            frames

The following variables, deduced from the parametric range (x, y),
may be used as constants:
- int X_SPAN, Y_SPAN

If HEIGHT is left to 0, then it is deduced using WIDTH and
RATIO.

To define a pixel color, the user shall redefine either rgb() or hsb()
function, which shall return a color according to the wanted color model,
and passing t if animation is wanted:
- color rgb(x, y) ....... No animation
- color rgb(x, y, t) .... Animate with TIME_INCREMENT or 1
- color hsb(x, y) ....... No animation
- color hsb(x, y, t) .... Animate with TIME_INCREMENT or 1

In these functions, the system variables width, height, mouseX,
mouseY, etc. may be used.

In addition to the coordinates in the parametric space (x and y),
which are passed as arguments to rgb() or hsb(), the u and v
variables are also available, giving the coordinates of the current
pixel in the canvas space.
                    </pre>
                  </div>
                  <div class="col">
                    <pre>
Note also that the following function may be redefined:
- bool preDraw(t) {} .... called before a frame is drawn: if it returns
                            true, the frame is drawn.
- void postDraw(t) {} ... called after a frame is drawn

Example formula, providing time animation and mouse interaction:
--------------------------------- cut here --------------------------------
WIDTH = 200;
float RATIO = 1;
TIME_INCREMENT = 0.02;
color rgb(x, y, t) {
  x = map(x, X_MIN, X_MAX, -1, 1);          // no care for param range
  y = map(y, Y_MIN, Y_MAX, -1, 1);          // no care for param range
  float r = dist(0, 0, x, y);               // Conv. cartesian to polar
  float theta = atan2(y, x);                // Conv. cartesian to polar

  theta += t;
  r += mouseX / width;
  r = pow(r*5, 0.67);                       // squeezes center a bit
  float ampli = (int)(mouseY/height*10 +1);
  float k = sq(sin(r*PI));                  // ripples
  float l = sq(sin(theta*ampli + k*PI/4));  // wavy rays
  float res = pow(k*l, 0.25);               // thinner black areas

  return color(res*255);                    // grayscales
}
--------------------------------- cut here --------------------------------

By default, the parameters are:
WIDTH  = 300;         X_MIN = 0;
RATIO  = 4/3;         X_MAX = 1;
HEIGHT = 0;           Y_MIN = 0;
FRAMES = 0;           Y_MAX = 1/RATIO;

CLICK_PAUSE = false;  TIME_INCREMENT   = 0;
OUT_PAUSE   = true;   FIRST_FRAME_TIME = 0;
MOUSE_MOVE  = false;
                    </pre>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Gallery -->
        <!-- TODO no link to dialog, bur list of thumbnails-->
        <div class="row pt-3">
          <div class="col-md-12">
            <h2>Gallery</h2>
          </div>

          <div class="container ml-2 pl-2">

            <!-- Dropbox public -->
            <div class="row">
              <div class="col-3">
                <span class="badge badge-pill badge-default"
                      style="cursor:pointer"
                      v-on:click="dropboxLoadSampleDialog">Load sample</span>
              </div>
              <div class="col-9">
                Public samples.
              </div>
            </div>

          </div>
        </div>

        <!-- Storage -->
        <div class="row pt-3">
          <div class="col-md-12">
            <h2>Storage</h2>
          </div>

          <div class="container ml-2 pl-2">

            <!-- Dropbox account -->
            <div class="row">
              <div class="col-3">
                <!-- buttons when logged in -->
                <div v-if="dropboxLoggedIn && dropboxDisplayname">
                  <span class="badge badge-pill badge-default" style="cursor:pointer" v-on:click="dropboxSaveDialog">
                    Save to Dropbox
                  </span><br/>
                  <span class="badge badge-pill badge-default" style="cursor:pointer" v-on:click="dropboxLoadDialog">
                    Load from Dropbox
                  </span>
                </div>
                <!-- buttons when logged out -->
                <div v-if="!dropboxLoggedIn || !dropboxDisplayname">
                  <span class="badge badge-pill badge-disabled">
                    Save to Dropbox
                  </span><br/>
                  <span class="badge badge-pill badge-disabled">
                    Load from to Dropbox
                  </span>
                </div>
              </div>
              <div class="col-9">
                <!-- links when logged in -->
                <div v-if="dropboxLoggedIn">
                  <div v-if="dropboxDisplayname">
                    <img style="height: 20px" v-bind:src="dropboxProfilePhotoUrl">
                    
                    <small>
                      {{dropboxDisplayname}}
                    </small>
                    |
                    <small>
                      <a href="https://www.dropbox.com/home/Apps/MathVue" target="_blank">
                        MathVue folder <i class="fas fa-external-link-alt"></i></a>
                    </small>
                    |
                    <small>
                      <div class="badge badge-pill badge-default" style="cursor:pointer" v-on:click="dropboxLogout">
                        Logout
                      </div>
                    </small>
                    
                  </div>
                  <div v-if="!dropboxDisplayname" style="display: inline-block;" class="progress">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                         role="progressbar" style="width: 100%; padding: 0 10px;">
                      Getting account infos...
                    </div>
                  </div>
                </div>
                <!-- login link when logged out -->
                <div v-if="!dropboxLoggedIn && dropboxAllowed">
                  Please
                  <a class="badge badge-pill badge-default" v-bind:href="dropboxLoginUrl">Login to Dropbox</a>
                  to access your Dropbox account.
                </div>
                <!-- hint when noi Dropbox possible -->
                <div v-if="!dropboxAllowed">
                  Cannot access Dropbox when running from file://
                </div>
              </div>
            </div>
          </div>

	</div>

        <!-- Exports -->
        <div class="row pt-3">
          <div class="col-md-12">
            <h2>Export</h2>
          </div>

          <div class="container ml-2 pl-2">

            <div class="row">
              <div class="col-3">
                <a class="badge badge-pill badge-default" v-bind:href="link">Link</a>
              </div>
              <div class="col-9">
                Link to current page, with formula as URL. Can be bookmarked.
              </div>
            </div>
            
            <div class="row">
              <div class="col-3">
                - Coming soon -
              </div>
              <div class="col-9">
                Grab and save image
              </div>
            </div>
            
            <div class="row">
              <div class="col-3">
                - Coming soon -
              </div>
              <div class="col-9">
                Save as animated GIF
              </div>
            </div>
            
            <div class="row">
              <div class="col-3">
                - Coming soon -
              </div>
              <div class="col-9">
                Save as Processing sketch (PDE)
              </div>
            </div>
            
            <div class="row">
              <div class="col-3">
                - Coming soon -
              </div>
              <div class="col-9">
                Save as standalone HTML5 page or snippet
              </div>
            </div>
          </div>
        </div>

        <!-- Discussion -->
        <div class="row pt-3">
          <div class="col-md-12">
            <h2>Discussion</h2>
            <!-- Disqus -->
            <div id="disqus_thread"></div>
            <script>
              /**
              *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
              *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
              /*
              var disqus_config = function () {
              this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
              this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
              };
              */
              (function() { // DON'T EDIT BELOW THIS LINE
              var d = document, s = d.createElement('script');
              s.src = 'https://mathvue.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
              })();
            </script>
          </div>
        </div>
        
      </div>
    </div>

    <!-- jQuery first, then Tether, then Bootstrap JS. -->
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script src="bootstrap4-dialog.js" crossorigin="anonymous"></script>

    <!-- Load Processing -->
    <script src="processing_v1.4.8.js"></script>
    <script src="pjs_glue.js"></script>

    <!-- Load Mathvision -->
    <script src="mathvision_template.js"></script>

    <!-- Dropbox -->
    <script src="dropbox_storage.js"></script>

    <!-- Get Vue, and load our app's code -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>    
    <script src="https://unpkg.com/vue-router@2.0.0/dist/vue-router.js"></script>
    <script src="file_dialog.js"></script>
    <script src="app.js"></script>

    <noscript>Please enable JavaScript for MathVue to work.</noscript>
    <script id="dsq-count-scr" src="//mathvue.disqus.com/count.js" async></script>
    
  </body>
</html>
